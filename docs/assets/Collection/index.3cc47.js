window.__require=function t(e,i,o){function s(r,a){if(!i[r]){if(!e[r]){var c=r.split("/");if(c=c[c.length-1],!e[c]){var l="function"==typeof __require&&__require;if(!a&&l)return l(c,!0);if(n)return n(c,!0);throw new Error("Cannot find module '"+r+"'")}r=c}var h=i[r]={exports:{}};e[r][0].call(h.exports,function(t){return s(e[r][1][t]||t)},h,h.exports,t,e,i,o)}return i[r].exports}for(var n="function"==typeof __require&&__require,r=0;r<o.length;r++)s(o[r]);return s}({CollectionItem:[function(t,e,i){"use strict";cc._RF.push(e,"584d67Py4FGnpwKvkh7sk8N","CollectionItem");var o,s=__extends,n=__decorate,r=__importDefault;Object.defineProperty(i,"__esModule",{value:!0}),i.State=void 0;var a,c=r(t("ResourceLoader")),l=cc._decorator,h=l.ccclass,d=l.property;(a=o=i.State||(i.State={}))[a.Normal=0]="Normal",a[a.Selected=1]="Selected",a[a.Disabled=2]="Disabled";var u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.icon=null,e.bgSprite=null,e.indexLabel=null,e.stateNodes=[],e.bgSpriteFrames=[],e.disabledIconSpriteFrame=null,e.itemIndex=-1,e.state=o.Normal,e}return s(e,t),e.prototype.updateItem=function(t,e){var i=this;this.itemIndex=t,this.state=e,this.indexLabel.string="No."+t,this.setState(e),e===o.Disabled?this.icon.spriteFrame=this.disabledIconSpriteFrame:c.default.getInstance().load("Collection","images/icons/"+t,cc.SpriteFrame).then(function(t){cc.isValid(i.node)&&(i.icon.spriteFrame=t)})},e.prototype.setState=function(t){this.bgSprite.spriteFrame=this.bgSpriteFrames[t];for(var e=0;e<this.stateNodes.length;e++)this.stateNodes[e].active=e===t},e.prototype.getItemIndex=function(){return this.itemIndex},e.prototype.getState=function(){return this.state},n([d(cc.Sprite)],e.prototype,"icon",void 0),n([d(cc.Sprite)],e.prototype,"bgSprite",void 0),n([d(cc.Label)],e.prototype,"indexLabel",void 0),n([d([cc.Node])],e.prototype,"stateNodes",void 0),n([d([cc.SpriteFrame])],e.prototype,"bgSpriteFrames",void 0),n([d(cc.SpriteFrame)],e.prototype,"disabledIconSpriteFrame",void 0),n([h],e)}(cc.Component);i.default=u,cc._RF.pop()},{ResourceLoader:void 0}],CollectionPage:[function(t,e,i){"use strict";cc._RF.push(e,"aaf27nQzFdF8LRH7SLxf64b","CollectionPage");var o=__extends,s=__decorate,n=__importStar,r=__importDefault;Object.defineProperty(i,"__esModule",{value:!0});var a=cc._decorator,c=a.ccclass,l=a.property,h=t("OverallSystem"),d=n(t("CollectionItem")),u=r(t("pageBase")),p=r(t("gameConfig1")),m=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.pageName="\u6536\u85cf\u9875\u9762",e.itemPrefab=null,e.scrollView=null,e.content=null,e.countLabel=null,e.columnCount=4,e.bufferRowCount=1,e.spacingX=10,e.spacingY=10,e.items=[],e.itemPool=null,e.totalCount=0,e.lastStartRow=-1,e.itemHeight=0,e.itemWidth=0,e.itemTotalHeight=0,e.colWidth=0,e.itemStartX=0,e.selectedIndex=-1,e.curLevel=0,e.allItems=[],e}return o(e,t),e.prototype.onLoad=function(){var t=this,e=h.sers().userSrv.getFeibiaoData();this.curLevel=e.level;var i=p.default.ROPE_MAX_LEVEL+1,o=this.curLevel;o>i&&(o=i),this.countLabel.string=o+"/"+i,this.itemPool=new cc.NodePool,this.scrollView.node.on("scrolling",this.onScrolling,this),this.initList(i),this.selectedIndex=h.sers().userSrv.getSelectedPainting(),cc.log("this.selectedIndex",this.selectedIndex),this.scheduleOnce(function(){t.scrollToItem(t.selectedIndex,!0),t.scheduleOnce(function(){t.onItemClick(t.selectedIndex)},.1)})},e.prototype.initList=function(t){this.totalCount=t,this.content.removeAllChildren(),this.items=[];var e=cc.instantiate(this.itemPrefab);this.itemWidth=e.width,this.itemHeight=e.height,this.itemTotalHeight=this.itemHeight+this.spacingY,e.destroy();var i=this.spacingX*(this.columnCount-1),o=this.itemWidth*this.columnCount,s=(this.content.width-(o+i))/2;this.itemStartX=-this.content.width/2+s+this.itemWidth/2;var n=Math.ceil(t/this.columnCount);this.content.height=n*this.itemTotalHeight+this.spacingY,this.content.width=this.scrollView.node.width,this.createAllItems(n),this.updateItems()},e.prototype.createAllItems=function(t){this.allItems=[],this.items=[];for(var e=0;e<t;e++){this.allItems[e]=[];for(var i=0;i<this.columnCount;i++){var o=e*this.columnCount+i;if(o>=this.totalCount)break;var s=this.createOrGetItem(),n=this.itemStartX+i*(this.itemWidth+this.spacingX),r=-(e*(this.itemHeight+this.spacingY)+this.itemHeight/2);s.setPosition(n,r),s.active=!1;var a=o===this.selectedIndex?d.State.Selected:d.State.Normal;o>=this.curLevel&&(a=d.State.Disabled),s.getComponent(d.default).updateItem(o,a),this.allItems[e][i]=s,this.items.push(s)}}},e.prototype.updateItems=function(){var t=Math.max(0,Math.floor(Math.abs(this.content.y)/this.itemTotalHeight)-this.bufferRowCount);this.content.y<0&&(t=0);var e=Math.ceil(this.scrollView.node.height/this.itemTotalHeight),i=Math.min(t+e+this.bufferRowCount,Math.ceil(this.totalCount/this.columnCount));t!==this.lastStartRow&&(this.lastStartRow=t,this.updateItemsVisibility(t,i))},e.prototype.updateItemsVisibility=function(t,e){for(var i=0;i<this.allItems.length;i++)(i<t||i>e)&&(o=this.allItems[i])&&o.forEach(function(t){t&&t.active&&(t.active=!1)});for(i=t;i<=e;i++){var o;(o=this.allItems[i])&&o.forEach(function(t){t&&!t.active&&(t.active=!0)})}},e.prototype.createOrGetItem=function(){var t=this,e=this.itemPool.size()>0?this.itemPool.get():cc.instantiate(this.itemPrefab);return e.parent=this.content,e.off(cc.Node.EventType.TOUCH_END),e.on(cc.Node.EventType.TOUCH_END,function(){var i=e.getComponent(d.default).getItemIndex();t.onItemClick(i,!0)},this),e},e.prototype.onItemClick=function(t,e){var i=this;if(void 0===e&&(e=!1),this.items.find(function(e){return e.getComponent(d.default).getItemIndex()===t}).getComponent(d.default).getState()!==d.State.Disabled){this.selectedIndex=t,e&&h.sers().uiSrv.showMessage("Painting switched, please return to home page"),cc.game.emit("changePainting",t);var o=h.sers().userSrv.getFeibiaoData();o.selectedPainting=this.selectedIndex,h.sers().userSrv.setFeibiaoData(o),this.items.forEach(function(t){var e=t.getComponent(d.default),o=e.getItemIndex();if(e.getState()!==d.State.Disabled){var s=o===i.selectedIndex?d.State.Selected:d.State.Normal;e.setState(s)}})}else h.sers().uiSrv.showMessage("Not Unlocked")},e.prototype.onScrolling=function(){this.updateItems()},e.prototype.scrollToItem=function(t,e){void 0===e&&(e=!1);var i=Math.floor(t/this.columnCount)*this.itemTotalHeight,o=this.content.height-this.scrollView.node.height,s=Math.min(o,i);e?(this.scrollView.scrollToOffset(cc.v2(0,s)),this.updateItems()):this.scrollView.scrollToOffset(cc.v2(0,s),.3)},s([l(cc.Prefab)],e.prototype,"itemPrefab",void 0),s([l(cc.ScrollView)],e.prototype,"scrollView",void 0),s([l(cc.Node)],e.prototype,"content",void 0),s([l(cc.Label)],e.prototype,"countLabel",void 0),s([l],e.prototype,"columnCount",void 0),s([l],e.prototype,"bufferRowCount",void 0),s([l],e.prototype,"spacingX",void 0),s([l],e.prototype,"spacingY",void 0),s([c],e)}(u.default);i.default=m,cc._RF.pop()},{CollectionItem:"CollectionItem",OverallSystem:void 0,gameConfig1:void 0,pageBase:void 0}]},{},["CollectionItem","CollectionPage"]);